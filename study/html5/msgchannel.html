<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>Message Channel</title>
	</head>
	<body>
		<div><input type="button" id="js_s" value="SendMsg"></div>
		<p></p>
		<div>
			<iframe src="./msgchannel2.html"></iframe>
		</div>
		<div>
			<div><input type="button" id="js_p" value="Post Msg"></div>
			<iframe id="js_i_receive" src="./msgchannelReceive.html"></iframe>
		</div>
		<script type="text/javascript">
			var channel = new MessageChannel();
			var para = document.querySelector('p');
			var ifr = document.querySelector('iframe');
			var otherWin = ifr.contentWindow;

			ifr.addEventListener('load', iframeLoaded, false);
			function iframeLoaded(){
				document.getElementById('js_s').addEventListener('click', function(){
					otherWin.postMessage('hello from the main page!', '*');	
				})
				
			}

			channel.port1.onmessage = handleMessage;
			function handleMessage(e){
				para.innerHTML = e.data;
			}
			// Demo 3
			(function(){
				var count =0;
				var winReceive = document.getElementById('js_i_receive');
				document.getElementById('js_p').addEventListener('click', function(){
					winReceive.contentWindow.postMessage('Message ' + (++count), "http://localhost")
				})
			})()

		</script>
	</body>
</html>